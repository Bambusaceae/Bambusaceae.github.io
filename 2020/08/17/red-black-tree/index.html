<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>红黑树入门 | Bambusoideae&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/favicon.ico">
    <script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?a04f74e26e451964b94a7461c1ed6d0d";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script>
    <link rel="alternate" type="application/rss+xml" href="https://bambusoideae.cn/rss.xml" title="Bambusoideae&#39;s Blog RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://bambusoideae.cn/feed.atom" title="Bambusoideae&#39;s Blog Atom Feed">
    <link rel="alternate" type="application/json" href="https://bambusoideae.cn/feed.json" title="Bambusoideae&#39;s Blog JSON Feed">
    <meta name="description" content="其实没有想象中的那么难。">
    <meta name="baidu-site-verification" content="ZkBG5vw3Wv">
    
    <link rel="preload" href="/assets/css/0.styles.c891cef4.css" as="style"><link rel="preload" href="/assets/js/app.e09869c4.js" as="script"><link rel="preload" href="/assets/js/2.37c14550.js" as="script"><link rel="preload" href="/assets/js/15.f9e6413d.js" as="script"><link rel="prefetch" href="/assets/js/10.e8288a53.js"><link rel="prefetch" href="/assets/js/11.63d30de9.js"><link rel="prefetch" href="/assets/js/12.de37642b.js"><link rel="prefetch" href="/assets/js/13.4f1ad00f.js"><link rel="prefetch" href="/assets/js/14.31f9dfff.js"><link rel="prefetch" href="/assets/js/3.dbec9540.js"><link rel="prefetch" href="/assets/js/4.0f867c87.js"><link rel="prefetch" href="/assets/js/5.8508d988.js"><link rel="prefetch" href="/assets/js/6.4cf484be.js"><link rel="prefetch" href="/assets/js/7.9fc8df0d.js"><link rel="prefetch" href="/assets/js/8.40e013da.js"><link rel="prefetch" href="/assets/js/9.0fd524f3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c891cef4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout"><nav id="nav" class="navbar sticky-top navbar-dark navbar-expand-lg"><div class="navbar-brand"><!----> <h1 class="title">红黑树入门</h1></div> <button type="button" aria-label="Toggle navigation" class="navbar-toggler"><span class="navbar-toggler-icon"></span></button> <div id="collapse" class="navbar-collapse collapse" style="display:none;"><ul class="navbar-nav"><li class="nav-item b-nav-dropdown dropdown"><a role="button" aria-haspopup="true" aria-expanded="false" href="#" target="_self" class="nav-link dropdown-toggle"><span>Feed</span></a><ul tabindex="-1" class="dropdown-menu"><li role="presentation"><a role="menuitem" href="/rss.xml" target="_self" class="dropdown-item">RSS</a></li> <li role="presentation"><a role="menuitem" href="/feed.atom" target="_self" class="dropdown-item">Atom</a></li> <li role="presentation"><a role="menuitem" href="/feed.json" target="_self" class="dropdown-item">JSON</a></li></ul></li> <li class="nav-item"><a href="/" target="_self" class="nav-link">Home</a></li> <li class="nav-item"><a href="/tag/" target="_self" class="nav-link">Tags</a></li></ul> <ul class="navbar-nav ml-auto"><li class="nav-item"><a href="https://github.com/Bambusaceae/" target="_self" class="nav-link">GitHub</a></li></ul></div></nav> <div class="article-content"><div class="container"><div class="content__default"><h1 id="前置知识"><a href="#前置知识" class="header-anchor">#</a> 前置知识</h1> <ul><li>二叉搜索树</li></ul> <h1 id="红黑树简介"><a href="#红黑树简介" class="header-anchor">#</a> 红黑树简介</h1> <h2 id="红黑树是什么"><a href="#红黑树是什么" class="header-anchor">#</a> 红黑树是什么</h2> <p>红黑树是一种弱平衡二叉树。相比 AVL（一种严格平衡二叉树），它牺牲了一部分的查询效率，从而实现它飞快的插入与删除操作。</p> <h2 id="红黑树的性质"><a href="#红黑树的性质" class="header-anchor">#</a> 红黑树的性质</h2> <p>红黑树主要有以下性质：</p> <ol><li>是一颗二叉查找树</li></ol> <ol start="2"><li>结点有红、黑两种颜色</li></ol> <ol start="3"><li>根结点、叶子结点（NIL，不维护任何数值）是黑色</li></ol> <ol start="4"><li>红色结点的子结点是黑色</li></ol> <ol start="5"><li>根结点到所有叶子结点的路径上的黑色结点数量相等（这个数值被称为 <code>黑高度</code>）</li></ol> <p>特别的，除了根结点可能是红色，这些性质对一颗红黑树的所有子树均适用。</p> <p>这些性质严格限制了红黑树的高度在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">O</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\operatorname O(\log n)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 级别，也让它成为了最难写、最难调的平衡树之一。</p> <h1 id="基本框架"><a href="#基本框架" class="header-anchor">#</a> 基本框架</h1> <p>根据上面的定义和性质，我们可以写出基本的程序框架：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">namespace</span> RBTree<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">node</span><span class="token punctuation">{</span><span class="token keyword">int</span> val<span class="token punctuation">,</span>color<span class="token punctuation">,</span>siz<span class="token punctuation">,</span>cnt<span class="token punctuation">;</span>node <span class="token operator">*</span>son<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">*</span>f<span class="token punctuation">;</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span>node<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//son[0]左儿子，son[1]右儿子，f父亲，color颜色</span>
    <span class="token punctuation">}</span><span class="token operator">*</span>nil<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span>root<span class="token operator">=</span>nil<span class="token punctuation">;</span><span class="token keyword">int</span> size<span class="token punctuation">;</span>
    node<span class="token operator">::</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">f</span><span class="token punctuation">(</span>nil<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">siz</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">cnt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>son<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>son<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>nil<span class="token punctuation">;</span><span class="token punctuation">}</span>
    node<span class="token operator">::</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token keyword">int</span> val<span class="token punctuation">,</span>node<span class="token operator">*</span> f<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">val</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">f</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">siz</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">cnt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>son<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>son<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>nil<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>k<span class="token punctuation">)</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>son<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span></span></span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>val<span class="token punctuation">)</span></span></span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>f<span class="token punctuation">)</span></span></span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">siz</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>siz<span class="token punctuation">)</span></span></span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>cnt<span class="token punctuation">)</span></span></span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">color</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>color<span class="token punctuation">)</span></span></span>
    <span class="token keyword">int</span> <span class="token function">checkred</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//查询红儿子的方向，右侧优先</span>
    <span class="token keyword">int</span> <span class="token function">check</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">s</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">==</span>u<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">&amp;</span> x<span class="token punctuation">,</span><span class="token keyword">int</span><span class="token operator">&amp;</span> y<span class="token punctuation">)</span><span class="token punctuation">{</span>x<span class="token operator">^=</span>y<span class="token punctuation">,</span>y<span class="token operator">^=</span>x<span class="token punctuation">,</span>x<span class="token operator">^=</span>y<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//查询结点相对父亲的方向、交换两数值</span>
    <span class="token keyword">void</span> <span class="token function">pushup</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">!=</span>nil<span class="token punctuation">)</span><span class="token function">siz</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">siz</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">siz</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//向上维护权值</span>
    <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>node<span class="token operator">*</span> x<span class="token punctuation">,</span>node<span class="token operator">*</span> y<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token function">val</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">val</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token function">siz</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">siz</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token function">cnt</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">cnt</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">pushup</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">pushup</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//交换权值</span>
    <span class="token keyword">void</span> <span class="token function">connect</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">,</span>node<span class="token operator">*</span> v<span class="token punctuation">,</span><span class="token keyword">int</span> k<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>v<span class="token operator">!=</span>nil<span class="token punctuation">)</span><span class="token function">s</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">=</span>u<span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">!=</span>nil<span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span>v<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//连边</span>
    <span class="token keyword">void</span> <span class="token function">cut</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span>node<span class="token operator">*</span> f<span class="token operator">=</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> k<span class="token operator">=</span><span class="token function">check</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>f<span class="token operator">!=</span>nil<span class="token punctuation">)</span><span class="token function">s</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">=</span>nil<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//断边</span>
    <span class="token keyword">void</span> <span class="token function">rotate</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">,</span><span class="token keyword">int</span> k<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>node <span class="token operator">*</span>v<span class="token operator">=</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>k<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span>t<span class="token operator">=</span><span class="token function">s</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span>f<span class="token operator">=</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> ku<span class="token operator">=</span><span class="token function">check</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>v<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token function">connect</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span>u<span class="token punctuation">,</span>k<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">connect</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">connect</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span>f<span class="token punctuation">,</span>ku<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">pushup</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">pushup</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>root<span class="token punctuation">)</span>root<span class="token operator">=</span>v<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>nil<span class="token operator">-&gt;</span>son<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>nil<span class="token operator">-&gt;</span>son<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>nil<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//旋转、初始化</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="红黑树的操作"><a href="#红黑树的操作" class="header-anchor">#</a> 红黑树的操作</h1> <h2 id="查询操作"><a href="#查询操作" class="header-anchor">#</a> 查询操作</h2> <p>同二叉查找树。</p> <h2 id="插入操作"><a href="#插入操作" class="header-anchor">#</a> 插入操作</h2> <h3 id="插入结点"><a href="#插入结点" class="header-anchor">#</a> 插入结点</h3> <p>从根开始向下寻找，同二叉查找树。遇到空的结点就插入。新插入的结点染成红色，这是为了避免破坏性质 5。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">namespace</span> RBTree<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span>node<span class="token operator">*</span> <span class="token operator">&amp;</span>u<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">,</span>node<span class="token operator">*</span> f<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span> u<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">node</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">insertfix</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">==</span>x<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">,</span><span class="token function">pushup</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&lt;</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">,</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">pushup</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">insertfix</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">insert</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span>x<span class="token punctuation">,</span>nil<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>看起来很简单？</p> <p>让人智息的操作在下面。</p> <h3 id="双红修正"><a href="#双红修正" class="header-anchor">#</a> 双红修正</h3> <p>我们发现直接插入一个结点可能会破坏性质 3、4。</p> <p>于是我们考虑修正。</p> <p>为了方便，我们给结点命名、着色如下（下同）：</p> <p><img src="https://cdn.luogu.com.cn/upload/image_hosting/liy3pn1q.png" alt=""></p> <ul><li>U 是当前修正的节点</li></ul> <ul><li>F 是 U 修正之前的父亲</li></ul> <ul><li>G 是 F 在 U 修正之前的父亲</li></ul> <ul><li>A 是 G 在 U 修正之前的另外一个儿子</li></ul> <ul><li>B 是 F 在 U 修正之前的另外一个儿子</li></ul> <ul><li>R 是一个特定的红色结点</li></ul> <ul><li>空心结点是将要修正的结点</li></ul> <ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">X</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm X_0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathrm">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是编号为 X 的结点的左子树，在合法情况下可以为空</li></ul> <ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">X</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm X_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathrm">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是编号为 X 的结点的右子树，在合法情况下可以为空</li></ul> <ul><li>结点的颜色就是图中所着的颜色</li></ul> <ul><li>对于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">X</mi><mrow><mn>0</mn><mi mathvariant="normal">/</mi><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\mathrm X_{0/1}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1.03853em;vertical-align:-0.3551999999999999em;"></span><span class="mord"><span class="mord mathrm">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">/</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span></span></span></span>，图中所着的颜色是是它的根结点的颜色</li></ul> <ul><li>图中着除红黑外的颜色的结点可以是任何颜色（对于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">X</mi><mrow><mn>0</mn><mi mathvariant="normal">/</mi><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\mathrm X_{0/1}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1.03853em;vertical-align:-0.3551999999999999em;"></span><span class="mord"><span class="mord mathrm">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">/</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span></span></span></span> 同样适用）; 除蓝色外，所有图中着相同颜色的结点的颜色相同。</li></ul> <p>分五种情况讨论。</p> <ol><li>U 或 F是黑色</li></ol> <p>不需要进行任何操作。</p> <ol start="2"><li>U 是根结点</li></ol> <p>染黑即可。此时全树黑高度增加 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>。</p> <ol start="3"><li>U、F、A 是红色，G 是黑色</li></ol> <p>显然，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">U</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">U</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">A</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">A</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm U_0, \mathrm U_1, \mathrm A_0, \mathrm A_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 F 的另一个子树的黑高度相等，所以直接染红 G，染黑 F、A，然后对 G 进行双红修正即可（这个可以在插入回溯的过程中进行）。</p> <p>e.g.</p> <ul><li>修正前</li></ul> <p><img src="https://cdn.luogu.com.cn/upload/image_hosting/9qpw5hqp.png" alt=""></p> <ul><li>修正后</li></ul> <p><img src="https://cdn.luogu.com.cn/upload/image_hosting/kumowa3z.png" alt=""></p> <ol start="4"><li>U、F 是红色，G 是黑色，A 是黑色，且 U 相对 F 的方向和 F 相对 G 的方向相同</li></ol> <p>显然，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">U</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">U</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm U_0, \mathrm U_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 F 的另一个子树的黑高度比 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">A</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">A</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm A_0, \mathrm A_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的黑高度大 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>。我们直接旋转 G，使 F 上调到 G 的位置，然后染黑 F，染红 G 即可。</p> <p>e.g.</p> <ul><li>修正前</li></ul> <p><img src="https://cdn.luogu.com.cn/upload/image_hosting/ao9wlhyv.png" alt=""></p> <ul><li>修正后</li></ul> <p><img src="https://cdn.luogu.com.cn/upload/image_hosting/0t16pmi3.png" alt=""></p> <ol start="5"><li>U、F 是红色，G 是黑色，A 是黑色，且 U 相对 F 的方向和 F 相对 G 的方向不同</li></ol> <p>显然，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">U</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">U</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm U_0, \mathrm U_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 F 的另一个子树的黑高度比 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">A</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">A</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm A_0, \mathrm A_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的黑高度大 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>。我们先旋转 F，使 U 上调到 F 的位置，再旋转 G，使 U 上调到 G 的位置，最后染红 G，染黑 U 即可。</p> <p>e.g.</p> <ul><li>修正前</li></ul> <p><img src="https://cdn.luogu.com.cn/upload/image_hosting/liy3pn1q.png" alt=""></p> <ul><li>修正后</li></ul> <p><img src="https://cdn.luogu.com.cn/upload/image_hosting/5zcjwqv4.png" alt=""></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">namespace</span> RBTree<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">insertfix</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>root<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token function">color</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">color</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token operator">||</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>
        node <span class="token operator">*</span>f<span class="token operator">=</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span>g<span class="token operator">=</span><span class="token function">f</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span>h<span class="token operator">=</span><span class="token function">s</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span><span class="token function">check</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> ku<span class="token operator">=</span><span class="token function">check</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span>kf<span class="token operator">=</span><span class="token function">check</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">pushup</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">pushup</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>node<span class="token operator">*</span> <span class="token function">get</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">==</span>x<span class="token operator">||</span>u<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span> u<span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&lt;</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">color</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>ku<span class="token operator">==</span>kf<span class="token punctuation">)</span><span class="token function">color</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">rotate</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span>kf<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token function">color</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">rotate</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>ku<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">rotate</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span>kf<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token function">color</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">color</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="删除操作"><a href="#删除操作" class="header-anchor">#</a> 删除操作</h2> <h3 id="删除结点"><a href="#删除结点" class="header-anchor">#</a> 删除结点</h3> <p>和普通的二叉查找树一样。若被删除结点有右子树，那么就用它在以它为根的子树范围内的后继结点替换它，否则用它的左子结点替换它。然后把替换结点当作被删除结点继续执行删除操作，直到叶子结点（忽略 NIL，下同）</p> <p>我们发现，最后真正删除的只有一个叶子结点。我们只要找出这个叶子结点，找的过程中替换一下，最后删除这个叶子结点即可。删除之前别忘了向上更新信息。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">namespace</span> RBTree<span class="token punctuation">{</span>
    node<span class="token operator">*</span> <span class="token function">get</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">==</span>x<span class="token operator">||</span>u<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span> u<span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&lt;</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>  <span class="token comment">//寻找结点</span>
    node<span class="token operator">*</span> <span class="token function">next</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!=</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token function">suc</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>  <span class="token comment">//寻找替换结点</span>
    <span class="token keyword">void</span> <span class="token function">up</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">while</span><span class="token punctuation">(</span>u<span class="token operator">!=</span>nil<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">pushup</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span>u<span class="token operator">=</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">//向上更新信息</span>
    <span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span>node<span class="token operator">*</span> u<span class="token operator">=</span><span class="token function">get</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">,</span><span class="token function">up</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//如果不止一个就只更新个数</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">siz</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>node<span class="token operator">*</span> v<span class="token operator">=</span><span class="token function">next</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">cnt</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">val</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span>u<span class="token operator">=</span>v<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">siz</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//寻找最终删除的结点</span>
        <span class="token function">up</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">delfix</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">cut</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>root<span class="token punctuation">)</span>root<span class="token operator">=</span>nil<span class="token punctuation">;</span><span class="token keyword">delete</span> u<span class="token punctuation">;</span>  <span class="token comment">//更新信息，删除</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>简单吗？不。</p> <h3 id="双黑修正"><a href="#双黑修正" class="header-anchor">#</a> 双黑修正</h3> <p>这也是红黑树最令人智息的操作之一。</p> <p>我们发现，删除一个叶子结点（忽略 NIL），若它是红色，则不会破坏红黑树的性质; 若它是黑色，那么会破坏红黑树的性质 5。那么就要对它进行双黑修正。理解的时候考虑下删除它对黑高度的影响。</p> <p>还是双红修正时的命名、着色方式。</p> <p>分情况讨论：</p> <ol><li>U 是红结点</li></ol> <p>不用执行任何操作。</p> <ol start="2"><li>U 是黑结点，B 是红结点</li></ol> <p>显然, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">U</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">U</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm U_0, \mathrm U_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的黑高度比 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">B</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">B</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm B_0, \mathrm B_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathrm">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 小 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>。只需要旋转 F，使 B 上调，然后给 B 染黑色，F 染红色，继续双黑修正。</p> <p>e.g.</p> <ul><li>修正前</li></ul> <p><img src="https://cdn.luogu.com.cn/upload/image_hosting/njsmzus7.png" alt=""></p> <ul><li>修正后</li></ul> <p><img src="https://cdn.luogu.com.cn/upload/image_hosting/eg8wno0u.png" alt=""></p> <ol start="3"><li>U, F, B 都是黑色，B 没有红儿子</li></ol> <p>显然，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">U</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">U</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm U_0, \mathrm U_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的黑高度比 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">B</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">B</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm B_0, \mathrm B_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathrm">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 小 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，所以只需染红 B。由于整颗子树的黑高度都少了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，所以还需要对 F 进行双黑修正。</p> <p>e.g.</p> <ul><li>修正前</li></ul> <p><img src="https://cdn.luogu.com.cn/upload/image_hosting/dvl8ja36.png" alt=""></p> <ul><li>修正后</li></ul> <p><img src="https://cdn.luogu.com.cn/upload/image_hosting/sgwnog7d.png" alt=""></p> <ol start="4"><li>U, B 是黑色，F 是红色，B 没有红儿子</li></ol> <p>显然，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">U</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">U</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm U_0, \mathrm U_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的黑高度比 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">B</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">B</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm B_0, \mathrm B_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathrm">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 小 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，又因 B 是黑色，F 是红色，所以只需把 F 染黑，B 染红即可。</p> <p>e.g.</p> <ul><li>修正前</li></ul> <p><img src="https://cdn.luogu.com.cn/upload/image_hosting/wq0wlfe2.png" alt=""></p> <ul><li>修正后</li></ul> <p><img src="https://cdn.luogu.com.cn/upload/image_hosting/91zpepc2.png" alt=""></p> <ol start="5"><li>U，B 是黑色，B 有红儿子</li></ol> <p>令 R 是 B 的红儿子。显然，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">U</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">U</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm U_0, \mathrm U_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的黑高度比 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">R</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi mathvariant="normal">R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\mathrm R_0, \mathrm R_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathrm">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 B 的另一个子树小 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>。</p> <p>分情况讨论</p> <ol><li>R 相对 B 的方向和 B 相对 F 的方向相同</li></ol> <p>直接旋转 F，将 B 上调，然后给 B 染 F 的颜色，F、R 染黑。</p> <p>e.g.<br>
- 修正前<br> <img src="https://cdn.luogu.com.cn/upload/image_hosting/o7i5g0cm.png" alt="">
- 修正后<br> <img src="https://cdn.luogu.com.cn/upload/image_hosting/k6a176hy.png" alt=""></p> <ol start="2"><li>R 相对 B 的方向和 B 相对 F 的方向不同</li></ol> <p>旋转 B，上调 R，旋转 F，上调 R，给 R 然 F 的颜色，F、B 染黑即可。</p> <p>e.g.<br>
- 修正前<br> <img src="https://cdn.luogu.com.cn/upload/image_hosting/4ckzgfki.png" alt="">
- 修正后<br> <img src="https://cdn.luogu.com.cn/upload/image_hosting/6tqgwlyy.png" alt=""></p> <p>然后 delfix 函数也就很容易写出来了。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">namespace</span> RBTree<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">delfix</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">color</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>u<span class="token operator">!=</span>root<span class="token punctuation">)</span><span class="token punctuation">{</span>node <span class="token operator">*</span>f<span class="token operator">=</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span>b<span class="token operator">=</span><span class="token function">s</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span><span class="token function">check</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> k<span class="token operator">=</span><span class="token function">check</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">rotate</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>u<span class="token operator">=</span>f<span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">int</span> kr<span class="token operator">=</span><span class="token function">checkred</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>node<span class="token operator">*</span> r<span class="token operator">=</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>kr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>kr<span class="token operator">==</span><span class="token function">check</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">rotate</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">color</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token function">rotate</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>kr<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">rotate</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="例题"><a href="#例题" class="header-anchor">#</a> 例题</h1> <h2 id="luogu-p6136-loj-104-【模板】普通平衡树-数据加强版"><a href="#luogu-p6136-loj-104-【模板】普通平衡树-数据加强版" class="header-anchor">#</a> <a href="https://www.luogu.com.cn/problem/P6136" target="_blank" rel="noopener noreferrer">Luogu-P6136<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>/<a href="https://loj.ac/problem/104" target="_blank" rel="noopener noreferrer">LOJ-104<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 【模板】普通平衡树（数据加强版）</h2> <ul><li><a href="https://www.luogu.com.cn/record/36565465" target="_blank" rel="noopener noreferrer">https://www.luogu.com.cn/record/36565465<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <ul><li><a href="https://loj.ac/submission/896855" target="_blank" rel="noopener noreferrer">https://loj.ac/submission/896855<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>所有操作整合一下就好了。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cstdio&gt;</span></span>
<span class="token keyword">namespace</span> Global<span class="token punctuation">{</span><span class="token keyword">int</span> n<span class="token punctuation">,</span>m<span class="token punctuation">,</span>last<span class="token punctuation">,</span>ans<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">int</span> ret<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>f<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>c<span class="token operator">&lt;</span><span class="token string">'0'</span><span class="token operator">||</span>c<span class="token operator">&gt;</span><span class="token string">'9'</span><span class="token punctuation">)</span>f<span class="token operator">*=</span><span class="token punctuation">(</span>c<span class="token operator">==</span><span class="token string">'-'</span><span class="token operator">?</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>c<span class="token operator">&gt;=</span><span class="token string">'0'</span><span class="token operator">&amp;&amp;</span>c<span class="token operator">&lt;=</span><span class="token string">'9'</span><span class="token punctuation">)</span>ret<span class="token operator">=</span><span class="token punctuation">(</span>ret<span class="token operator">&lt;&lt;</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>ret<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>c<span class="token operator">^</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> ret<span class="token operator">*</span>f<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">namespace</span> RBTree<span class="token punctuation">{</span><span class="token keyword">using</span> <span class="token keyword">namespace</span> Global<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">node</span><span class="token punctuation">{</span><span class="token keyword">int</span> val<span class="token punctuation">,</span>color<span class="token punctuation">,</span>siz<span class="token punctuation">,</span>cnt<span class="token punctuation">;</span>node <span class="token operator">*</span>son<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">*</span>f<span class="token punctuation">;</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span>node<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token operator">*</span>nil<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span>root<span class="token operator">=</span>nil<span class="token punctuation">;</span><span class="token keyword">int</span> size<span class="token punctuation">;</span>
    node<span class="token operator">::</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">f</span><span class="token punctuation">(</span>nil<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">siz</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">cnt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>son<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>son<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>nil<span class="token punctuation">;</span><span class="token punctuation">}</span>
    node<span class="token operator">::</span><span class="token function">node</span><span class="token punctuation">(</span><span class="token keyword">int</span> val<span class="token punctuation">,</span>node<span class="token operator">*</span> f<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">val</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">f</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">siz</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">cnt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>son<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>son<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>nil<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>k<span class="token punctuation">)</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>son<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span></span></span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>val<span class="token punctuation">)</span></span></span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>f<span class="token punctuation">)</span></span></span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">siz</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>siz<span class="token punctuation">)</span></span></span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>cnt<span class="token punctuation">)</span></span></span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression"><span class="token function">color</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token punctuation">(</span>u<span class="token operator">-&gt;</span>color<span class="token punctuation">)</span></span></span>
    <span class="token keyword">int</span> <span class="token function">checkred</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">int</span> <span class="token function">check</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">s</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">==</span>u<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">&amp;</span> x<span class="token punctuation">,</span><span class="token keyword">int</span><span class="token operator">&amp;</span> y<span class="token punctuation">)</span><span class="token punctuation">{</span>x<span class="token operator">^=</span>y<span class="token punctuation">,</span>y<span class="token operator">^=</span>x<span class="token punctuation">,</span>x<span class="token operator">^=</span>y<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">pushup</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">!=</span>nil<span class="token punctuation">)</span><span class="token function">siz</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">siz</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">siz</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>node<span class="token operator">*</span> x<span class="token punctuation">,</span>node<span class="token operator">*</span> y<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token function">val</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">val</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token function">siz</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">siz</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token function">cnt</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">cnt</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">pushup</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">pushup</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">connect</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">,</span>node<span class="token operator">*</span> v<span class="token punctuation">,</span><span class="token keyword">int</span> k<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>v<span class="token operator">!=</span>nil<span class="token punctuation">)</span><span class="token function">s</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">=</span>u<span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">!=</span>nil<span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span>v<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">cut</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span>node<span class="token operator">*</span> f<span class="token operator">=</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> k<span class="token operator">=</span><span class="token function">check</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>f<span class="token operator">!=</span>nil<span class="token punctuation">)</span><span class="token function">s</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token operator">=</span>nil<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">rotate</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">,</span><span class="token keyword">int</span> k<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>node <span class="token operator">*</span>v<span class="token operator">=</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>k<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span>t<span class="token operator">=</span><span class="token function">s</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span>f<span class="token operator">=</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> ku<span class="token operator">=</span><span class="token function">check</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>v<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token function">connect</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span>u<span class="token punctuation">,</span>k<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">connect</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">connect</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span>f<span class="token punctuation">,</span>ku<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">pushup</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">pushup</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>root<span class="token punctuation">)</span>root<span class="token operator">=</span>v<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>node<span class="token operator">*</span> <span class="token function">kth</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">,</span><span class="token keyword">int</span> k<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>nil<span class="token operator">||</span><span class="token function">siz</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>k<span class="token operator">&amp;&amp;</span><span class="token function">siz</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&gt;=</span>k<span class="token punctuation">)</span><span class="token keyword">return</span> u<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">siz</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&lt;</span>k<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token function">kth</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>k<span class="token operator">-</span><span class="token function">siz</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">kth</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">val</span><span class="token punctuation">(</span><span class="token function">kth</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    node<span class="token operator">*</span> <span class="token function">pre</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span> nil<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&lt;</span>x<span class="token punctuation">)</span><span class="token punctuation">{</span>node<span class="token operator">*</span> v<span class="token operator">=</span><span class="token function">pre</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token punctuation">(</span>v<span class="token operator">==</span>nil<span class="token operator">||</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token function">val</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span>u<span class="token operator">:</span>v<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token function">pre</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>node<span class="token operator">*</span> <span class="token function">suc</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span> nil<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&gt;</span>x<span class="token punctuation">)</span><span class="token punctuation">{</span>node<span class="token operator">*</span> v<span class="token operator">=</span><span class="token function">suc</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token punctuation">(</span>v<span class="token operator">==</span>nil<span class="token operator">||</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token function">val</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span>u<span class="token operator">:</span>v<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token function">suc</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">pre</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">val</span><span class="token punctuation">(</span><span class="token function">pre</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">suc</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">val</span><span class="token punctuation">(</span><span class="token function">suc</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">int</span> <span class="token function">rank</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">==</span>x<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token function">siz</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&lt;</span>x<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token function">siz</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">rank</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token function">rank</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">rank</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">rank</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">insertfix</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>root<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token function">color</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">color</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token operator">||</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>
        node <span class="token operator">*</span>f<span class="token operator">=</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span>g<span class="token operator">=</span><span class="token function">f</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span>h<span class="token operator">=</span><span class="token function">s</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span><span class="token function">check</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> ku<span class="token operator">=</span><span class="token function">check</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span>kf<span class="token operator">=</span><span class="token function">check</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">pushup</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">pushup</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">color</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>ku<span class="token operator">==</span>kf<span class="token punctuation">)</span><span class="token function">color</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">rotate</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span>kf<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token function">color</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">rotate</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>ku<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">rotate</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span>kf<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token function">color</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">color</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span>node<span class="token operator">*</span> <span class="token operator">&amp;</span>u<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">,</span>node<span class="token operator">*</span> f<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span> u<span class="token operator">=</span><span class="token keyword">new</span> <span class="token function">node</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">insertfix</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">==</span>x<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">,</span><span class="token function">pushup</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&lt;</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">,</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">pushup</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">insertfix</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">insert</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span>x<span class="token punctuation">,</span>nil<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>nil<span class="token operator">-&gt;</span>son<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>nil<span class="token operator">-&gt;</span>son<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>nil<span class="token punctuation">;</span><span class="token punctuation">}</span>
    node<span class="token operator">*</span> <span class="token function">get</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">==</span>x<span class="token operator">||</span>u<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span> u<span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&lt;</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">delfix</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">color</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>u<span class="token operator">!=</span>root<span class="token punctuation">)</span><span class="token punctuation">{</span>node <span class="token operator">*</span>f<span class="token operator">=</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">*</span>b<span class="token operator">=</span><span class="token function">s</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span><span class="token function">check</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> k<span class="token operator">=</span><span class="token function">check</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">rotate</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>u<span class="token operator">=</span>f<span class="token punctuation">;</span><span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">int</span> kr<span class="token operator">=</span><span class="token function">checkred</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>node<span class="token operator">*</span> r<span class="token operator">=</span><span class="token function">s</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>kr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>kr<span class="token operator">==</span><span class="token function">check</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">rotate</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">color</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token function">rotate</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>kr<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">rotate</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">color</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>node<span class="token operator">*</span> <span class="token function">next</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!=</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token function">suc</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">s</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">up</span><span class="token punctuation">(</span>node<span class="token operator">*</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">while</span><span class="token punctuation">(</span>u<span class="token operator">!=</span>nil<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">pushup</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span>u<span class="token operator">=</span><span class="token function">f</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{</span>node<span class="token operator">*</span> u<span class="token operator">=</span><span class="token function">get</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>nil<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">,</span><span class="token function">up</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">siz</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>node<span class="token operator">*</span> v<span class="token operator">=</span><span class="token function">next</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">cnt</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">val</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">val</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span>u<span class="token operator">=</span>v<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">siz</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">cnt</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">up</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">delfix</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">cut</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">==</span>root<span class="token punctuation">)</span>root<span class="token operator">=</span>nil<span class="token punctuation">;</span><span class="token keyword">delete</span> u<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token keyword">using</span> RBTree<span class="token operator">::</span>find<span class="token punctuation">;</span><span class="token keyword">using</span> RBTree<span class="token operator">::</span>pre<span class="token punctuation">;</span><span class="token keyword">using</span> RBTree<span class="token operator">::</span>suc<span class="token punctuation">;</span><span class="token keyword">using</span> RBTree<span class="token operator">::</span>rank<span class="token punctuation">;</span><span class="token keyword">using</span> RBTree<span class="token operator">::</span>insert<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> Global<span class="token punctuation">;</span><span class="token keyword">using</span> RBTree<span class="token operator">::</span>init<span class="token punctuation">;</span><span class="token keyword">using</span> RBTree<span class="token operator">::</span>del<span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>n<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>m<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>m<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">int</span> opt<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>opt<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token function">insert</span><span class="token punctuation">(</span>x<span class="token operator">^</span>last<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>opt<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token function">del</span><span class="token punctuation">(</span>x<span class="token operator">^</span>last<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>opt<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span>ans<span class="token operator">^=</span><span class="token punctuation">(</span>last<span class="token operator">=</span><span class="token function">rank</span><span class="token punctuation">(</span>x<span class="token operator">^</span>last<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>opt<span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span>ans<span class="token operator">^=</span><span class="token punctuation">(</span>last<span class="token operator">=</span><span class="token function">find</span><span class="token punctuation">(</span>x<span class="token operator">^</span>last<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>opt<span class="token operator">==</span><span class="token number">5</span><span class="token punctuation">)</span>ans<span class="token operator">^=</span><span class="token punctuation">(</span>last<span class="token operator">=</span><span class="token function">pre</span><span class="token punctuation">(</span>x<span class="token operator">^</span>last<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>opt<span class="token operator">==</span><span class="token number">6</span><span class="token punctuation">)</span>ans<span class="token operator">^=</span><span class="token punctuation">(</span>last<span class="token operator">=</span><span class="token function">suc</span><span class="token punctuation">(</span>x<span class="token operator">^</span>last<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\n&quot;</span><span class="token punctuation">,</span>ans<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="作图工具"><a href="#作图工具" class="header-anchor">#</a> 作图工具</h1> <ul><li>文中所有作图均使用 <a href="https://www.geogebra.org/geometry" target="_blank" rel="noopener noreferrer">GeoGebra·几何<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h1 id="references"><a href="#references" class="header-anchor">#</a> References</h1> <ul><li>[1] <a href="https://www.jianshu.com/p/e136ec79235c" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/e136ec79235c<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <ul><li>[2] <a href="https://blog.csdn.net/Gosick_Geass_Gate/article/details/88556840" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/Gosick_Geass_Gate/article/details/88556840<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <ul><li>[3] <a href="https://www.luogu.com.cn/blog/_post/26864" target="_blank" rel="noopener noreferrer">https://www.luogu.com.cn/blog/_post/26864<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <div class="none-select details"><svg viewBox="0 0 16 16" width="1em" height="1em" focusable="false" role="img" aria-label="clock" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi-clock b-icon bi"><g><path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm8-7A8 8 0 1 1 0 8a8 8 0 0 1 16 0z"/><path fill-rule="evenodd" d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5z"/></g></svg> <span>2020 08 07 Fri 03:19:09</span> <br> <svg viewBox="0 0 16 16" width="1em" height="1em" focusable="false" role="img" aria-label="pen" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi-pen b-icon bi"><g><path fill-rule="evenodd" d="M13.498.795l.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001zm-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708l-1.585-1.585z"/></g></svg> <span>2020 10 17 Sat 07:00:25</span> <br> <div><svg viewBox="0 0 16 16" width="1em" height="1em" focusable="false" role="img" aria-label="tags" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi-tags b-icon bi"><g><path fill-rule="evenodd" d="M3 2v4.586l7 7L14.586 9l-7-7H3zM2 2a1 1 0 0 1 1-1h4.586a1 1 0 0 1 .707.293l7 7a1 1 0 0 1 0 1.414l-4.586 4.586a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 2 6.586V2z"/><path fill-rule="evenodd" d="M5.5 5a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1zm0 1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/><path d="M1 7.086a1 1 0 0 0 .293.707L8.75 15.25l-.043.043a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 0 7.586V3a1 1 0 0 1 1-1v5.086z"/></g></svg> <div class="tag-badge"><a href="/tag/学习笔记" target="_self" class="btn btn-primary btn-sm">
                学习笔记
            </a></div><div class="tag-badge"><a href="/tag/OI相关" target="_self" class="btn btn-primary btn-sm">
                OI相关
            </a></div><div class="tag-badge"><a href="/tag/数据结构" target="_self" class="btn btn-primary btn-sm">
                数据结构
            </a></div><div class="tag-badge"><a href="/tag/树形结构" target="_self" class="btn btn-primary btn-sm">
                树形结构
            </a></div> </div></div> <div id="gitalk-container"></div></div></div> <div id="footer"><div class="container"><div class="row"><div class="col"><div class="footer-title">Links</div> <div class="row"><div class="col"><a href="https://blog.coelacanthus.moe/">ayalhw 的博客</a></div></div><div class="row"><div class="col"><a href="https://keepthethink.github.io/">Helium 的博客</a></div></div><div class="row"><div class="col"><a href="https://2759942374.github.io/">F Zx 的博客</a></div></div><div class="row"><div class="col"><a href="http://175.24.116.241/">Schwarzkopf-Henkal 的博客</a></div></div></div> <div class="col"><div class="footer-title">Description</div> <p>一个专门存放 OI 方面的博文的博客。</p></div></div> <div class="row"><hr></div> <div class="row"><div class="col"><div class="info">Theme: <a href="https://github.com/Bambusaceae/vuepress-theme-bootstrap-simple">bootstrap-simple</a></div></div></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e09869c4.js" defer></script><script src="/assets/js/2.37c14550.js" defer></script><script src="/assets/js/15.f9e6413d.js" defer></script>
  </body>
</html>
